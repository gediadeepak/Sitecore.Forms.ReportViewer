(function(n){var r=function(n,t,i,r,u,f=true){n.errorMessageBar.IsVisible=!0;f||(n.errorMessageBar.IsVisible=!1);n.errorMessageBar.reset([{Type:t,Text:i,IsTemporary:r,IsClosable:u}])},i;const t={Notify:"Notification",Error:"Error"};i=function(n,t,i=0){const r=new Date(n.FormattedDate),u=new Date(t.FormattedDate),f=Math.abs(u-r),e=Math.ceil(f/864e5);return e>i?!1:!0};n.pageCode(["knockout","jquery.dataTables.min","dataTables.buttons.min","jszip.min","buttons.html5.min","buttons.print.min"],function(){var n={};window.onerror=function(n,t,i){window.jsErrors||(window.jsErrors=[]);window.jsErrors.push(n+"\n"+t+":"+i)};var f=function(n){$.ajax({type:"POST",processData:!1,contentType:"application/json",url:"/api/v1/forms/",success:function(t){if(t&&t.Data&&t.IsSuccess){var i=JSON.parse(t.Data);n.Form1.SelectForm.DynamicData=i}}})},e=function(t){$.ajax({type:"POST",processData:!1,contentType:"application/json",data:'{"FormId":"'+t+'","StartDate":"","EndDate":""}',url:"/api/v1/forms/langByFormId",success:function(t){if(t&&t.Data&&t.IsSuccess){var i=JSON.parse(t.Data);n.Form1.SelectLanguage.DynamicData=i}}})},o=function(n){var t=$('[data-sc-id="btnReport"]');t&&(n==!0?$(t).removeAttr("disabled"):$(t).attr("disabled","true"))},s=function(n){var t=$("#ribbonPreLoadingIndicator");t&&(n==!0?$(t).attr("style","display:block"):$(t).attr("style","display:none"))},u=function(n,t){window.setTimeout(function(){o(n);s(t)},500)},h=function(n){var t="";return(n.Form1.SelectForm.SelectedItem===""||n.Form1.SelectForm.SelectedItem.Id=="0")&&(t=t+"Form name"),n.Form1.StartDate.getDate()==null&&(t.length>0&&(t=t+", "),t=t+"start date"),n.Form1.EndDate.getDate()==null&&(t.length>0&&(t=t+", "),t=t+"end date"),t};return{initialized:function(){n=this;n.btnReport.on("click",this.btnReportClick,this);f(n);u(!0,!1)},formSelectionChangedEvent:function(){n.Form1.SelectForm.SelectedItem&&e(n.Form1.SelectForm.SelectedItem.Id)},btnReportClick:function(){function f(n,t,i,u,f,e=true){r(n,t,i,u,f,e)}var l=n.Form1.getFormData();if(u(!1,!0),errorJson=h(n),errorJson.length>0){u(!0,!1);f(n,t.Error,"There is some Error before submitting the details. "+errorJson+" details are not supplied to generate the report.",!0,!0,!0);return}if(!i(n.Form1.StartDate,n.Form1.EndDate,365)){errorJson="You can extract report only for 365 days.";f(n,t.Error,errorJson,!0,!0,!0);u(!0,!1);return}u(!0,!1);var e=n.Form1.SelectForm.SelectedItem.Id,o=this.generateDate(n.Form1.StartDate),s=this.generateDate(n.Form1.EndDate),c='{"Language":"en","FormId":"'+e+'","StartDate":"'+o+'","EndDate":"'+s+'"}';$.ajax({type:"POST",processData:!1,contentType:"application/json",url:"/api/v1/forms/report",data:c,success:function(t){var h,c,r,l,e,a,v;if(t&&t.Data&&t.IsSuccess){var i=JSON.parse(t.Data),o=i.ReportData,y=i.ReportColumn,s=$("#tblPlaceholder");s.html("");h='<table id="rptGrid" width="100%"><thead><tr><\/tr><\/thead><\/table>';s.html(h);c=$("#rptGrid");r="";r=y.replace("'",'"');l=$("#rptGrid >thead tr");$(l).append(i.TableHead);f(n,"Notification","Total "+o.length+" records found.",!0,!0,!0);e=c.DataTable({data:o,columns:JSON.parse("["+r+"]"),dom:"Bfrtip",dom:"Bfrtip",buttons:[{extend:"copy",text:"Copy Report"},{extend:"csv",text:"Export to CSV"},{extend:"excel",text:"Export to Excel"},]});a=e.column(0);a.visible(!1);u(!0,!1);v='<table class="table"><thead class="thead-dark"><tr><th scope="col">Field Name<\/th><th scope="col">Field Value<\/th><\/tr><\/thead><tbody>$tbody<\/tbody><\/table>';$("#rptGrid tbody").on("click","tr",function(){var t;if($(n.Section2.el).html(""),$("#rptGrid tbody tr").removeClass("selected"),$(this).addClass("selected"),t=e.rows(".selected").data(),t.length>0){var i=t[0],u="<tr><td>$colname<\/td><td>$colvalue<\/td><\/tr>",r="";Object.getOwnPropertyNames(i).forEach(n=>{var t=u.replace("$colname",n).replace("$colvalue",i[n]);r+=t});$(n.Section2.el).html(v.replace("$tbody",r));n.formItem.show()}})}else f(n,"Warning",t.ResponseMessage,!0,!0,!0)}})},generateDate:function(n){var t=n.Date;return t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,5)+":"+t.substr(11,2)+":"+t.substr(13,3)},btnExcelClick:function(){var n=$("#rptGrid").DataTable(),t=n.buttons.exportData()},btnCsvClick:function(){alert("btncsv clicked")}}})})(Sitecore.Speak);